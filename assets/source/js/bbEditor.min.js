$.fn.bbEditor=function(i){var g=this,c=null,h,m;var b=$.extend({insertToolCaller:"bb-insertTool-open"},i);var k=function(){var q='<div id="bb-insertTool" class="modal fade" role="dialog"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-body"><div class="loader"></div></div><div class="modal-footer"><button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button></div></div></div></div>';$(q).insertAfter(g);m=$(document).find("#bb-insertTool");var p=m.find(".modal-body");var o=m.find(".loader");$(document).on("click","#"+b.insertToolCaller,function(){var r=$(this);m.modal("show");o.show();$.ajax({method:"GET",url:home_path+"/bricks/builder/inserttool",success:function(s){p.empty().append(s);l(r)}}).done(function(){})})};var l=function(o){var p=o.closest(".bb-insertable");if(p.length===0){c=g;h="append"}else{c=p;h="prepend"}};$(document).on("click",".bb-insert",function(){j($(this))});var f=function(){var o=new Date().getTime();return Math.floor((Math.random()*10000)+1)+o};var j=function(o){m.modal("hide");o.attr("data-bb-id",f());o.find(".bb-element-example").remove();var p=o[0].outerHTML.replace("bb-insert","");if(h==="append"){c.append(p)}else{if(h==="prepend"){c.prepend(p)}}d(o);n()};var d=function(o){if(o.data("bb-type")==="block-text"){tinymce.init({selector:'.bb-element[data-bb-id="'+o.data("bb-id")+'"]',inline:true})}a(o)};var n=function(){$(".bb-insertable").sortable()};var a=function(q){var r='<div class="bb-elementMenu"></div>',p='<i class="fa fa-plus bb-addElement" id="'+b.insertToolCaller+'"></i>',o='<i class="fa fa-gear"></i>',s='<i class="fa fa-trash bb-removeElement"></i>';c.find('.bb-element[data-bb-id="'+q.data("bb-id")+'"]').append(r);c.find('.bb-element[data-bb-id="'+q.data("bb-id")+'"] .bb-element').append(r);c.find('.bb-element[data-bb-id="'+q.data("bb-id")+'"] .bb-elementMenu').each(function(t){if($(this).parent().hasClass("bb-insertable")){$(this).append(p)}if($(this).parent().hasClass("bb-customizable")){$(this).append(o)}if($(this).parent().hasClass("bb-removable")){$(this).append(s)}})};var e=function(){$('<div class="row"><div class="col-sm-12 text-center mt10"><div class="bb-addElement btn btn-default btn-lg" id="'+b.insertToolCaller+'"><i class="fa fa-plus"></i></div></div></div>').insertAfter(g)};k();e();return this};